import requests
import json

# API Configuration
URL = "http://localhost:8000/predict"
API_KEY = "unitshub-secret"  # Default API key, change if needed
HEADERS = {
    "Authorization": f'Bearer {API_KEY}',
    "Content-Type": "application/json"
}

# The data you provided
csv_data = """Time,TOTAIRFL,TOTFUELFL,TOTFWFL,SPROUTT,MSTEAMFL,MSTMPRESS,HAC71CT002,HAD83CT005,HAH82CT007,HAH84CT006,HAH79CT009,HAD83CT002,HAD83CT003,HAH79CT005,HAH79CT011,FWFUELDIV,HAH79CT001,HAH84CT004,HAD83CT001,HAH79CT007,HAH79CT004,HAH79CT006,HAH84CT005,HAD83CT006,HAH79CT008,HAH82CT004,HAH79CT002,HAH82CT002,HAH79CT003,HAH82CT005,HAH84CT003,HAD83CT004,HAH82CT003,HAH82CT001,HAH82CT008,HAH82CT011,HAH82CT012,HAH84CT001,HAH79CT012,HAH79CT010,HAH82CT009,HAH84CT002,HAH82CT010,HAH82CT006,HHA02AA19X1,HBB12AA18X1,HHA01AA19X1,HBB12AA17X1,HBB12AA14X1,HHA03AA19X1,HBB12AA13X1,HBB12AA16X1,HHA04AA19X1,HBB12AA12X1,HBB12AA15X1,HBB12AA11X1,LAB72CF0A2,LBB30CT306,LAB72CF0A1,LAB72CF0A4,LBB30CT,LBB30CP,LBA30CT,LAB72CF0A3,LDCOUT
2020-6-11 8:0:0,681.160888671875,91.51293182373051,0,358.105895996094,479.170562744141,12.1097259521484,251.79963684082,343.64303588867205,501.351623535156,568.072937011719,406.919555664063,348.949768066406,349.341064453125,407.79074096679705,407.63330078125,4.95579433441162,413.990112304688,567.867126464844,349.9921875,408.63375854492205,408.303649902344,406.814880371094,568.600891113281,343.702392578125,394.971374511719,487.036773681641,411.60794067382795,503.545776367188,414.145568847656,486.64523315429705,551.5885009765631,345.125396728516,504.79635620117205,494.792358398438,499.097412109375,485.769195556641,489.005950927734,553.518371582031,406.963775634766,403.72439575195295,498.784851074219,553.917663574219,487.424560546875,487.333374023438,98.66180419921879,99.96129608154301,49.108585357665994,100.263481140137,11.1555080413818,50.307258605957,11.5120534896851,93.1380615234375,50.06612396240229,11.397620201110804,100.118530273438,11.2450408935547,0.0910862907767296,233.710876464844,0.31819370388984697,0.0912468135356903,565.264221191406,1.65642523765564,558.230163574219,1.6533317565918002,171.315231323242
2020-6-11 8:0:5,682.6182861328131,91.53536987304692,0,358.17141723632795,479.98416137695295,12.101347923278801,251.801940917969,343.72653198242205,501.27706909179705,568.060302734375,408.23367309570295,349.034515380859,349.427093505859,407.873901367188,407.710784912109,4.95533609390259,414.070953369141,567.854736328125,350.116546630859,409.9494323730471,408.381530761719,406.840881347656,568.5858154296881,343.75927734375,395.25289916992205,487.22021484375,411.668762207031,503.73831176757795,414.22390747070295,486.85250854492205,551.5618896484381,345.201477050781,505.001953125,494.754638671875,498.324768066406,485.805328369141,489.212310791016,553.490417480469,407.040618896484,403.75906372070295,498.145843505859,553.888671875,487.547607421875,487.540649414063,98.6619415283203,99.96127319335942,49.104373931884794,100.26348876953101,11.1555490493774,50.3073539733887,11.5120534896851,93.13806915283199,50.0663070678711,11.397620201110804,100.11853790283199,11.2450408935547,0.0910868346691132,233.70471191406295,0.3181940615177151,0.0912473052740097,565.296813964844,1.6561239957809402,558.26611328125,0.09107214212417597,171.315231323242"""

def main():
    # 1. Choose a target column (e.g., TOTAIRFL)
    # For demonstration, we'll manually extract some points
    # Index 1 is TOTAIRFL
    history = [681.160888671875, 682.6182861328131]
    
    # 2. Build the request payload
    payload = {
        "instances": [
            {
                "history": history,
                "metadata": {"sensor_id": "TOTAIRFL"}
            }
        ],
        "task": {
            "horizon": 5  # Number of points to predict
        },
        "parameters": {
            "freq": "auto" # or 'H', 'D', '5min' etc depending on model
        }
    }

    # 3. Call the API
    try:
        response = requests.post(URL, json=payload, headers=HEADERS)
        response.raise_for_status()
        
        result = response.json()
        print(f"Model used: {result['model']}")
        
        for i, forecast in enumerate(result['forecasts']):
            print(f"Forecast for instance {i}:")
            print(f"Mean: {forecast['mean']}")
            if forecast.get('quantiles'):
                print(f"Quantiles: {forecast['quantiles']}")
                
    except Exception as e:
        print(f"Error: {e}")
        if 'response' in locals() and response.text:
            print(f"Response: {response.text}")

if __name__ == "__main__":
    main()
